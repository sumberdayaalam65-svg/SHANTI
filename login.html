<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login - SHANTI</title>
    <link
      rel="icon"
      type="image/png"
      href="https://raw.githubusercontent.com/sumberdayaalam65-svg/SHANTI/main/LogoSHANTI.png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #00274d, #004080, #0059b3);
      }
      h1,
      h2,
      h3 {
        font-family: "Poppins", sans-serif;
      }
      /* Perkecil toast */
      .swal2-toast {
        font-size: 12px !important;
        padding: 6px 10px !important;
        min-width: 180px !important;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <main class="bg-white rounded-2xl shadow-lg w-full max-w-md p-8 sm:p-10">
      <header class="mb-6 text-center">
        <h1 class="text-3xl font-bold text-[#004080]">SHANTI</h1>
        <p class="mt-2 text-sm text-gray-500">Masuk untuk mengakses layanan</p>
      </header>

      <form id="loginForm" class="space-y-4">
        <!-- Username -->
        <div class="relative flex items-center">
          <input
            id="username"
            type="text"
            placeholder="Masukkan username"
            class="w-full border rounded-lg h-12 px-4 pr-12 focus:ring-2 focus:ring-[#004080] focus:outline-none"
          />
          <span
            class="absolute right-3 flex items-center h-full text-gray-400 pointer-events-none"
          >
            <i class="fa-solid fa-user"></i>
          </span>
        </div>

        <!-- Password -->
        <div class="relative flex items-center">
          <input
            id="password"
            type="password"
            placeholder="Masukkan password"
            class="w-full border rounded-lg h-12 px-4 pr-12 focus:ring-2 focus:ring-[#004080] focus:outline-none"
          />
          <button
            id="togglePasswordBtn"
            type="button"
            class="absolute right-3 flex items-center h-full text-gray-600 hover:text-gray-900 p-1 rounded focus:outline-none"
            aria-label="Tampilkan password"
          >
            <i id="eyeOpen" class="fa-regular fa-eye hidden"></i>
            <i id="eyeClosed" class="fa-regular fa-eye-slash"></i>
          </button>
        </div>

        <!-- Submit -->
        <div>
          <button
            id="submitBtn"
            type="submit"
            class="w-full bg-[#ffd200] text-[#004080] py-3 rounded-lg font-semibold hover:bg-[#e6c200] transition"
          >
            Masuk
          </button>
        </div>

        <!-- Back to home -->
        <p class="mt-2 text-center text-gray-500 text-sm">
          <a
            href="index.html"
            class="text-[#004080] font-semibold hover:underline"
            >‚Üê Kembali ke Beranda</a
          >
        </p>
      </form>

      <footer class="mt-6 text-center text-xs text-gray-400">
        <p>¬© <span id="year"></span> SHANTI. Semua Hak Dilindungi.</p>
      </footer>

      <script>
        document.getElementById("year").textContent = new Date().getFullYear();
      </script>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      // üöÄ Auto-redirect jika sudah login
      if (localStorage.getItem("loggedIn") === "true") {
        window.location.href = "dashboard.html";
      }

      const loginForm = document.getElementById("loginForm");
      const usernameInput = document.getElementById("username");
      const passwordInput = document.getElementById("password");
      const togglePasswordBtn = document.getElementById("togglePasswordBtn");
      const eyeOpen = document.getElementById("eyeOpen");
      const eyeClosed = document.getElementById("eyeClosed");

      // Toggle show/hide password
      togglePasswordBtn.addEventListener("click", () => {
        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          eyeOpen.classList.remove("hidden");
          eyeClosed.classList.add("hidden");
        } else {
          passwordInput.type = "password";
          eyeOpen.classList.add("hidden");
          eyeClosed.classList.remove("hidden");
        }
      });

      // Toast template kecil
      const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 2200,
        timerProgressBar: true,
        customClass: { popup: "swal2-toast" },
        didOpen: (toast) => {
          toast.onmouseenter = Swal.stopTimer;
          toast.onmouseleave = Swal.resumeTimer;
        },
      });

      // Load Users dari Google Apps Script
      async function loadUsers() {
        try {
          const res = await fetch(
            "https://script.google.com/macros/s/AKfycbzRlmiUGIrj99esYGvFPSb3N7IwoaRZugOQIzRc6IGAa1rIduRdKJ0eVPGmOefd-ey_/exec"
          );
          return await res.json();
        } catch (error) {
          console.error("Gagal ambil data user:", error);
          return [];
        }
      }

      // Handler Login
      loginForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (!username || !password) {
          Toast.fire({ icon: "warning", title: "Isi username dan password!" });
          return;
        }

        const users = await loadUsers();
        const user = users.find((u) => u.username === username);

        if (!user) {
          Toast.fire({ icon: "error", title: "Username tidak ditemukan!" });
          return;
        }

        if (String(user.password).trim() !== password.trim()) {
          Toast.fire({ icon: "error", title: "Password salah!" });
          return;
        }

        if (user.status.trim().toLowerCase() !== "aktif") {
          Toast.fire({
            icon: "error",
            title: "Akun Nonaktif, hubungi Administrator!",
          });
          return;
        }

        if (user.role.trim().toLowerCase() !== "administrator") {
          Toast.fire({
            icon: "error",
            title: "Hanya Administrator yang bisa login!",
          });
          return;
        }

        // ‚úÖ Berhasil login (Administrator)
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("username", user.username);
        localStorage.setItem("role", user.role);

        Toast.fire({
          icon: "success",
          title: `Selamat datang ${user.username}`,
        }).then(() => {
          window.location.href = "dashboard.html";
        });
      });
    </script>
  </body>
</html>
